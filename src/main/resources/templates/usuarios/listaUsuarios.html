<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/base :: head(styles='/css/form-styles.css')}"></head>
<body>

    <header th:replace="~{fragments/base :: headerCompleto}"></header>

    <main class="container mt-4">
        <h1 class="mb-3">Lista de Usuarios</h1>

        <div th:if="${msg != null}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${msg}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        
        <div th:if="${msgError != null}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${msgError}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <p>
            <a th:href="@{/usuarios/crear}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Nuevo Usuario
            </a>
        </p>

        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Nombre Completo</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Perfiles</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="usuario : ${usuarios}">
                        <td th:text="${usuario.id}"></td>
                        <td th:text="${usuario.nombre}"></td>
                        <td th:text="${usuario.username}"></td>
                        <td th:text="${usuario.email}"></td>
                        <td>
                            <span th:each="perfil : ${usuario.perfiles}" 
                                  th:text="${perfil.perfil}" 
                                  class="badge bg-secondary me-1">
                            </span>
                        </td>
                        <td>
						    <a th:href="@{/usuarios/editar/{id}(id=${usuario.id})}" 
						       class="btn btn-warning btn-sm" 
						       sec:authorize="hasAuthority('ADMIN')"> <i class="bi bi-pencil-fill"></i>
						    </a>
						
						    <a th:href="@{/usuarios/eliminar/{id}(id=${usuario.id})}" 
						       class="btn btn-danger btn-sm" 
						       onclick="return confirm('Â¿Seguro?')"
						       sec:authorize="hasAuthority('ADMIN')"> <i class="bi bi-trash-fill"></i>
						    </a>
						</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <footer th:replace="~{fragments/base :: footer}"></footer>
    
</body>
</html>