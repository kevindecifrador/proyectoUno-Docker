<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/base :: head(styles='/css/form-styles.css')}"></head>
<body>
    <header th:replace="~{fragments/base :: headerCompleto}"></header>

    <main class="container mt-4 p-4 rounded shadow-lg" 
	      style="background-color: #B49214; color: #fff; max-width: 900px; max-height: 500px; margin: auto;">
        
        <h3>Asignar Cuenta de Usuario al Cliente:</h3>
        <h1 class="display-6" th:text="${cliente.nombre + ' ' + cliente.apellidos}"></h1>
        <hr>

        <div th:if="${msgError}" class="alert alert-danger" th:text="${msgError}"></div>

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="crear-tab" data-bs-toggle="tab" data-bs-target="#crear" type="button" role="tab" aria-controls="crear" aria-selected="true">
                    1. Crear Nuevo Login
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="vincular-tab" data-bs-toggle="tab" data-bs-target="#vincular" type="button" role="tab" aria-controls="vincular" aria-selected="false">
                    2. Vincular Existente
                </button>
            </li>
        </ul>

        <form th:action="@{/usuarios/guardarLoginAsignado}" method="post" th:object="${usuario}" class="border border-top-0 p-3 mb-4">
            
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <input type="hidden" name="clienteId" th:value="${clienteId}" />

            <div class="tab-content" id="myTabContent">

                <div class="tab-pane fade show active" id="crear" role="tabpanel" aria-labelledby="crear-tab">
                    <p>Crea una nueva cuenta de usuario (con rol CLIENTE) para esta persona.</p>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="username" class="form-label">Nombre de Usuario (Username)</label>
                                <input type="text" class="form-control" th:field="*{username}" id="username">
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Contraseña</label>
                                <input type="password" class="form-control" th:field="*{password}" id="password">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="vincular" role="tabpanel" aria-labelledby="vincular-tab">
                    <p>Selecciona una cuenta de usuario (con rol CLIENTE) que ya exista y no esté asignada a nadie.</p>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="usuarioIdExistente" class="form-label">Usuarios Cliente Disponibles</label>
                            <select name="usuarioIdExistente" id="usuarioIdExistente" class="form-select">
                                <option value="">-- No vincular ninguno --</option>
                                <option th:each="u : ${usuariosSinAsignar}" 
                                        th:value="${u.id}" 
                                        th:text="${u.username + ' (Email: ' + u.email + ')'}">
                                </option>
                            </select>
                            <div class="form-text" th:if="${usuariosSinAsignar.isEmpty()}">
                                No se encontraron usuarios con rol CLIENTE sin asignar.
                            </div>
                        </div>
                    </div>
                </div>
            </div> 
            
            <hr>
            <button type="submit" class="btn btn-success">
                <i class="bi bi-check-lg"></i> Guardar y Asignar
            </button>
            <!--  
            <a th:href="@{/empleados}" class="btn btn-secondary">Cancelar</a>
            -->
        </form>
    </main>

   <footer th:replace="~{fragments/base :: footer}"></footer>
</body>
</html>