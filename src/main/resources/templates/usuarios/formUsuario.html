<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/base :: head(styles='/css/form-styles.css')}"></head>
<body>

    <header th:replace="~{fragments/base :: headerCompleto}"></header>

    <main class="container mt-4">
        
        <h1 th:text="${usuario.id != null ? 'Editar Usuario' : 'Crear Usuario'}"></h1>
        <hr>

        <form th:action="@{/usuarios/guardar}" method="post" th:object="${usuario}">
        
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <input type="hidden" th:field="*{id}">

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre Completo</label>
                        <input type="text" class="form-control" th:field="*{nombre}" id="nombre"
                               th:errorclass="'is-invalid'">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" th:field="*{username}" id="username"
                               th:errorclass="'is-invalid'">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" th:field="*{email}" id="email"
                               th:errorclass="'is-invalid'">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="password" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" th:field="*{password}" id="password"
                               th:errorclass="'is-invalid'">
                        <small class="form-text text-muted" th:if="${usuario.id != null}">
                            Dejar en blanco para no cambiar la contraseña.
                        </small>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
                    </div>
                </div>
                
                <div class="col-md-6">
    
				    <div class="mb-3" sec:authorize="hasAuthority('ADMIN')">
				        <label for="estatus" class="form-label">Estatus</label>
				        <select th:field="*{estatus}" id="estatus" class="form-select">
				            <option value="1">Activo</option>
				            <option value="0">Inactivo</option>
				        </select>
				    </div>
				    
				    <div class="mb-3" th:if="${usuario.fechaRegistro != null}">
				        <label for="fechaRegistro" class="form-label">Fecha de Registro</label>
				        <input type="text" class="form-control" th:field="*{fechaRegistro}" id="fechaRegistro" readonly>
				    </div>
				
				    <div class="mb-3" sec:authorize="hasAuthority('ADMIN')">
				        <label class="form-label">Perfiles Asignados</label>
				        <div class="card">
				            <div class="card-body">
				                <div th:each="perfil : ${perfiles}" class="form-check">
				                    <input class="form-check-input" type="checkbox" 
				                           th:field="*{perfiles}" 
				                           th:value="${perfil.id}" 
				                           th:id="|perfil_${perfil.id}|">
				                    <label class="form-check-label" th:for="|perfil_${perfil.id}|" th:text="${perfil.perfil}"></label>
				                </div>
				            </div>
				        </div>
				    </div>
				
				</div>
            </div> <hr>
            <button type="submit" class="btn btn-success">Guardar Usuario</button>
            <a th:href="@{/usuarios/index}" class="btn btn-secondary">Regresar</a>

        </form>
    </main>

   <footer th:replace="~{fragments/base :: footer}"></footer>
    
</body>
</html>